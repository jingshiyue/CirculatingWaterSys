<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>设备管理</title>
<meta name="Keywords" content="设备管理" >
<meta name="Description" content="设备管理" >
<link href="/static/css/style2/style.css" rel="stylesheet" type="text/css">
<script src="/static/js/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery-cookie/1.0/jquery.cookie.min.js"></script>
<script src="/static/js/login.js" type="text/javascript"></script>

</head>
<body>

    <div class="warp">
		
        <div class="ej_bt">设备管理<a href="javascript:history.back(-1)" class="fh"><img src="/static/images/fanhui.png" /></a><a href="http://ro.yueshuidz.com/index/Equipment/pclist.html?maxDeviceID=3999999&page=1" class="bx" style="color:#6d08ff">大屏展示</a></div>
         
        <div class="ej_cx">
             <div class="cx_l">设备列表（总量:6台；在线:0台；故障:0台）</div>
             <!-- <div class="cx_r login-header"><a href="javascript:void(0);">查询<img src="/static/images/x.png" /></a></div> -->
             <div class=" clear"></div>
        </div>

        <div class="ej_cx">
            <div class="cx_r login-header" style="margin-top: 3%; float: left; margin-left: 25%;">
                <a href="javascript:void(0);" >查询<img src="/static/images/x.png" /></a>
            </div>
            <div class="cx_r login-header" style="margin-top: 3%; float: right; margin-right: 25%;">
                <a href="javascript:void(0);" >添加<img src="/static/images/x.png" /></a>
            </div>
            <div class=" clear"></div>

        </div>
        
                <div class="login">
				<form onsubmit="javascript:return submit1();" id="queryDevice">
                    <div class="login-title"><span><a href="javascript:void(0);" class="close-login">关闭</a></span></div>
                    <div class="login-input-content">
                        <div class="login-input">
                            <label>控制器编号：</label>
                            <input type="text" placeholder="请输入主板编号"  name="DeviceID" id="DeviceID" class="list-input"/>
                        </div>
                        
                        <div class="login-input" id="onlineState">
                            <label>网络状态：</label>
                            <span><input name="NetState" type="radio" value="1"  class="zx" style="width:30px;height:30px"/>在线  </span>
                            <span><input name="NetState" type="radio" value="0" class="zx"  style="width:30px;height:30px"/>离线 </span>
                        </div>
                        <div class="login-input">
                            <label>设备状态：</label>
                           
                         <select style="padding: 5px 10px;width:260px; font-size:2em;" name="DeviceState">
                                <option></option>
                                 
                                <option value="0"  selected>出厂</option> 
                                 
                                <option value="1"  >正常制水</option> 
                                 
                                <option value="2"  >冲洗</option> 
                                 
                                <option value="3"  >水满</option> 
                                 
                                <option value="4"  >缺水</option> 
                                 
                                <option value="5"  >臭氧</option> 
                                 
                                <option value="6"  >清洗前置罐</option> 
                                 
                                <option value="10"  >参数设置失败</option> 
                                 
                                <option value="11"  >正常制水_repeat?</option> 
                                 
                                <option value="12"  >冲洗</option> 
                                 
                                <option value="13"  >水满</option> 
                                 
                                <option value="14"  >缺水</option> 
                                 
                                <option value="15"  >臭氧</option> 
                                 
                                <option value="16"  >清洗前置罐</option> 
                                 
                                <option value="20"  >无原水</option> 
                                 
                                <option value="21"  >低压</option> 
                                 
                                <option value="30"  >无原水</option> 
                                 
                                <option value="31"  >低压</option> 
                                                                 <option selected></option>
                                                                <!-- <option value="" selected>请选择状态</option> -->
                          
                            </select>
                           
                           
                        </div>
                    </div>
                    <div class="login-button">
					
                     <!-- <button  class="btn_confirm" type="submit" id="login-button-submit">查询</button> -->
                     <input  class="btn_confirm" type="submit" id="login-button-submit" value="查询" />
					
					</div>
					</form>
                </div>




        <div class="login-bg"></div>        
        <div id="deviceList"  class="er_main">
        	<!-- <div class="er_1">
            	<dl>
                <dt>设备ID：3000012</dt>
                <dd>备注名称：临鼎</dd>
                <div class=" clear"></div>
                </dl>
                
                <ul class="er_2">
                    <li>离线</li> 
					                     <li></li>     
                                        <li>2℃</li>
                    <li>信号 23</li>
                 <div class=" clear"></div>
                </ul>
                
                <ul class="er_3">
					<li><button type="button"  onclick="power(2,'f0311c1e-e289-ea11-b0df-87120c3b66e0','关机');" class="kgj">关机</button></li>                                       
                    <li><a href="/index/setting/sell/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">参数设置</a></li>
                    <li><a href="/index/Equipment/statetu/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">设备运行状态</a></li>
                    <li><a href="/index/Equipment/edit/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">修改</a></li>
                    <li><a href="/index/Equipment/info/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">更多</a></li>
                    <div class=" clear"></div>
                </ul>
            </div> -->
		</div>
        
 
        <div id="pagination1" class="page fl">
            <div class="ui-pagination-container">
                <a id="pre" href="#" class="ui-pagination-page-item" onclick="return false;" data-current="2">上一页</a>
                <a id="total" class="ui-pagination-page-item" data-current="2">共 页</a>
                <a id="next" href="#" class="ui-pagination-page-item" onclick="return false;" data-current="2">下一页</a>
            </div>
        </div>            
                
            <div class="footer"></div>
			
        <div class="footerdb">
            <ul>
                <li><a href="/index/index.html"><div class="tp1"></div><div class="tp4">首页</div><div class="clear"></div></a> </li>
                <li class="list"><a href="/index/Equipment/index.html"><div class="tp2"></div><div class="tp4">设备</div><div class="clear"></div></a></li>
                <li><a href="/index/index/my.html"><div class="tp3"></div><div class="tp4">我的</div><div class="clear"></div></a></li>
                <div class="clear"></div>
            </ul>
        </div>
    </div><!--warp-->
    
</body>
    <script src="/static/js/layer/mobile/layer.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/mdialog.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
    function power(status,id,title){
        layer.open({
            content: '您确定要'+title+'吗？',
            btn: ['确认', '取消'],
            yes: function(index){
                layer.close(index);
                var url = "/index/equipment/power.html";
                data = {};
                data['Id'] = id;
                data['status'] = status;
                $.post(url,data,function(res){
                    if (res.status == '1') {
                        // dialog.success(res.message,res.url);
                        location.reload();
                    }else if(res.status == '0'){
                        dialog.error(res.message,res.url);
                    }
                },"JSON");
                
            }
            
        });
        
    }
    </script>
    <script>
        String.format = function(src){  
            if (arguments.length == 0) return null;  
            var args = Array.prototype.slice.call(arguments, 1);  
            return src.replace(/\{(\d+)\}/g, function(m, i){  
                return args[i];  
            });  
        };  

    function getParameter(el){
        var obj={};
        $(el).each(function(index,item){
            // 判断元素的类型
            alert(el)
            alert(item.html())
            if(item.type=="text" || item.type=="password" || item.type=="select-one" || item.type=="tel" || 
            item.type=="search" || item.type=="range" || item.type=="number" || item.type=="month" || 
            item.type=="email" || item.type=="datetime-local" || item.type=="datetime" || item.type=="date" || 
            item.type=="color"){
            //获取到name的值,name的值就是向后台传递的数据
            obj[$(this).attr("name")]=$(this).val();
            alert(2)

            }else if(item.type=="checkbox"){
            var stamp=false;
            if($(this).attr("name") && !stamp){
            stamp=false;
            // 获取到复选框选中的元素
            var checkboxEl=$("input[name="+$(item).attr('name')+"]:checked");
            if(checkboxEl){
            var checkboxArr=[];
            // 取出复选框选中的值
            checkboxEl.each(function(idx,itm){
                checkboxArr.push($(itm).val());
            });
            obj[$(this).attr("name")]=checkboxArr.join(",");
            }
            
            }
            }else if(item.type=="radio"){
            // 获取到单选框选中的值
            var radio_val=$("input[name="+$(item).attr('name')+"]:checked").val();
            if(radio_val){
            obj[$(item).attr("name")]=radio_val;
            }
            }
        });
        return obj;
    }


        var map_whether_online = function(arg){
            if (arg == 0) 
                var online = "离线";
            if (arg == 1) 
                var online = "上线";
            if (arg == 2) 
                var online = "未知";
            return online;
        }

        $(".ui-pagination-page-item").click(function(){
            if ($(this).attr('href')){
                $.ajax({
                    type:'GET',
                    url: $(this).attr('href'),
                    cache: false,
                    beforeSend: function (XMLHttpRequest) {
                        XMLHttpRequest.setRequestHeader("Authorization","JWT "+$.cookie('token'));
                    },
                    success:function(data){
                        // console.log(data)
                        
                        var templateStr =`
                        <div class="er_1"> 
                            <dl> 
                                <dt>设备ID：{0}</dt> 
                                <dd>备注名称：{1}</dd> 
                                <div class=" clear"></div>
                            </dl>
                            <ul class="er_2">
                                <li>{2}</li> 
                                <li></li>     
                                <li>{3}℃</li>
                                <li>信号 {4}</li>
                                <div class=" clear"></div>
                            </ul>
                            <ul class="er_3">
                                <li><button type="button"  onclick="power(2,'f0311c1e-e289-ea11-b0df-87120c3b66e0','关机');" class="kgj">关机</button></li>                                 
                                <li><a href="/index/setting/sell/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">参数设置</a></li> 
                                <li><a href="/index/Equipment/statetu/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">设备运行状态</a></li> 
                                <li><a href="/index/Equipment/edit/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">修改</a></li> 
                                <li><a href="/index/Equipment/info/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">更多</a></li> 
                                <div class=" clear"></div>
                            </ul>
                        </div>
                        `
                        
                        // console.log($("#pre").attr('href'))
                        // console.log($(this).attr('href'))
                        $("#pre").attr("href",data["previous"]);
                        // $("#total").html("共"+Math.ceil(data["count"]/10) +"页");
                        $("#next").attr("href",data["next"]);
                        $("#deviceList").empty()
                        for (idx in data["results"]){
                            deviceList = String.format(templateStr,
                                data["results"][idx]["device_id"],
                                data["results"][idx]["remarks"],
                                map_whether_online(data["results"][idx]["online"]),
                                data["results"][idx]["temperature"],
                                data["results"][idx]["signal"],
                            )
                            $("#deviceList").append(deviceList)
                        }
                    }
                })
            }   
        })
        
        function submit1(){
            var DeviceID = $("#DeviceID").val()
            var NetState = $('input[name="NetState"]:checked').val()
            var DeviceState = $('select :selected').val()
            // console.log(DeviceID)
            var url = String.format(
                "/queryDeviceAPIView?DeviceID={0}&NetState={1}&DeviceState={2}",
                DeviceID,
                NetState,
                DeviceState
            )
            $.ajax({
                type:'GET',
                url:url,
                cache: false,
                // type:"json",
                beforeSend: function (XMLHttpRequest) {
                    XMLHttpRequest.setRequestHeader("Authorization","JWT "+$.cookie('token'));
                },
                success:function(data){
                    console.log(data)
                }
            });
            return false;
        }


        $(document).ready(function(){
            $.ajax({
                type:'GET',
                url:"/queryStatistics/",
                cache: false,
                beforeSend: function (XMLHttpRequest) {
                        XMLHttpRequest.setRequestHeader("Authorization","JWT "+$.cookie('token'));
                    },
                success:function(data){
                    var templateStr = "设备列表（总量:{0}台；在线:{1}台；故障:{2}台）"
                    $(".ej_cx:first .cx_l").text(
                        String.format(templateStr,data["total"],data["online"],data["fault"])
                    );
                }
                
            })
            
            $.ajax({
					type:'GET',
					url:"/deviceQuery/?page=1&page_size=10/",
                    cache: false,
                    beforeSend: function (XMLHttpRequest) {
                        XMLHttpRequest.setRequestHeader("Authorization","JWT "+$.cookie('token'));
                    },
					success:function(data){
                        var templateStr =`
                        <div class="er_1"> 
                            <dl> 
                                <dt>设备ID：{0}</dt> 
                                <dd>备注名称：{1}</dd> 
                                <div class=" clear"></div>
                            </dl>
                            <ul class="er_2">
                                <li>{2}</li> 
                                <li></li>     
                                <li>{3}℃</li>
                                <li>信号 {4}</li>
                                <div class=" clear"></div>
                            </ul>
                            <ul class="er_3">
                                <li><button type="button"  onclick="power(2,'f0311c1e-e289-ea11-b0df-87120c3b66e0','关机');" class="kgj">关机</button></li>                                 
                                <li><a href="/index/setting/sell/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">参数设置</a></li> 
                                <li><a href="/index/Equipment/statetu/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">设备运行状态</a></li> 
                                <li><a href="/index/Equipment/edit/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">修改</a></li> 
                                <li><a href="/index/Equipment/info/Id/f0311c1e-e289-ea11-b0df-87120c3b66e0.html">更多</a></li> 
                                <div class=" clear"></div>
                            </ul>
                        </div>
                        `
                          
                        $("#pre").attr("href",data["previous"]);
                        $("#total").html("共"+Math.ceil(data["count"]/10) +"页");
                        $("#next").attr("href",data["next"]);
                        for (idx in data["results"]){
                            deviceList = String.format(templateStr,
                                data["results"][idx]["device_id"],
                                data["results"][idx]["remarks"],
                                map_whether_online(data["results"][idx]["online"]),
                                data["results"][idx]["temperature"],
                                data["results"][idx]["signal"],
                            )
                            $("#deviceList").append(deviceList)
                        }
					}
			})

            

        })
    </script>
</html>