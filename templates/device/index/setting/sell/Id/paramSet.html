<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>设备管理</title>
<meta name="Keywords" content="设备管理" >
<meta name="Description" content="设备管理" >
<link href="/static/css/style2/style.css" rel="stylesheet" type="text/css">
<script src="/static/js/jquery.min.js" type="text/javascript"></script>
<script src="/static/js/jquery.cookie.js"></script>
<script src="/static/js/login.js" type="text/javascript"></script>
<script src="/static/js/honeySwitch.js" type="text/javascript"></script>

<style type="text/css">
.weui-switch {
  -webkit-appearance: none;
          appearance: none;
}
.weui-switch {
  position: relative;
  width: 52px;
  height: 32px;
  border: 1px solid #DFDFDF;
  outline: 0;
  border-radius: 16px;
  box-sizing: border-box;
  background-color: #DFDFDF;
  -webkit-transition: background-color 0.1s, border 0.1s;
  transition: background-color 0.1s, border 0.1s;
}
.weui-switch:before{
  content: " ";
  position: absolute;
  top: 0;
  left: 0;
  width: 50px;
  height: 30px;
  border-radius: 15px;
  background-color: #FDFDFD;
  -webkit-transition: -webkit-transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
  transition: -webkit-transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
  transition: transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
  transition: transform 0.35s cubic-bezier(0.45, 1, 0.4, 1),-webkit-transform 0.35s cubic-bezier(0.45, 1, 0.4, 1);
}
.weui-switch:after {
  content: " ";
  position: absolute;
  top: 0;
  left: 0;
  width: 30px;
  height: 30px;
  border-radius: 15px;
  background-color: #FFFFFF;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
  -webkit-transition: -webkit-transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
  transition: -webkit-transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
  transition: transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
  transition: transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35), -webkit-transform 0.35s cubic-bezier(0.4, 0.4, 0.25, 1.35);
}
.weui-switch:checked{
  border-color: #04BE02;
  background-color: #04BE02;
}
.weui-switch:checked:before {
  -webkit-transform: scale(0);
          transform: scale(0);
}
.weui-switch:checked:after {
  -webkit-transform: translateX(20px);
          transform: translateX(20px);
}
</style>
</head>

<body>

    <div class="warp">
        <form id="h-form" onsubmit="javascript:return add_submit();"></form>
		<div style="clear: both;"></div>
            <div class="footer">山东跃水电子科技有限公司</div>
    </div><!--warp-->
<script>
var SCOPE = {
  'post_url' : ""
}
</script>
<script src="/static/js/layer/mobile/layer.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/mdialog.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/mcommon.js" type="text/javascript" charset="utf-8"></script>
<script>
    tmpStr = `
        <div class="ej_bt">反渗透设备参数设置<a href="javascript:history.back(-1)" class="fh"><img src="/static/images/fanhui.png" /></a></div>
         
        <dl class="sbcs sbcs1">
        	<dt><strong>设备ID</strong></dt>
            <dd><strong>{0}</strong></dd>
            <div class="clear"></div>
        </dl>
         
        <dl class="sbcs">
        	<dt>开启冲洗阀时间1T(1-240秒)</dt>
            <dd class="cssz"><input type="number"  name="yukoufeicanshu" value="{1}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
         
        <dl class="sbcs" style="line-height: 42px;">
        	<dt>开启制水泵时间2T(1-240秒) <br />高压洗膜2T参数不用</dt>
            <dd class="cssz"><input type="number"   name="liuliangjimaichongshu" value="{2}"  class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
        
        <dl class="sbcs">
        	<dt>循环冲洗时间3T(1-240秒)</dt>
            <dd class="cssz"><input type="number"  name="shuakadashuishijian" value="{3}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		 <dl class="sbcs">
        	<dt>水满后冲洗时间4T(1-240秒)</dt>
            <dd class="cssz"><input type="number"  name="toubidashuishijian" value="{4}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		 <dl class="sbcs">
        	<dt>冲洗时间间隔5T(1-240分)</dt>
            <dd class="cssz"><input type="number"  name="maimaichongshuiliang" value="{5}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		 <dl class="sbcs">
        	<dt>水满制水泵停止时间6T(5-240秒)</dt>
            <dd class="cssz"><input type="number"  name="qianshuhuishoushijian" value="{6}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		 <dl class="sbcs">
        	<dt>臭氧杀菌时间7T(5-240秒)</dt>
            <dd class="cssz"><input type="number"  name="chouyangshajunshijian" value="{7}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		
		 <dl class="sbcs">
        	<dt>臭氧杀菌间隔8T(10-240分)</dt>
            <dd class="cssz"><input type="number"  name="chouyangshajunjiange" value="{8}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		
		 <dl class="sbcs">
        	<dt>温控加热启动温度1C(1-30℃)</dt>
            <dd class="cssz"><input type="number"  name="jiarewenduxiaxian" value="{9}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
		
		 <dl class="sbcs">
        	<dt>温控加热停止温度2C(1-30℃)</dt>
            <dd class="cssz"><input type="number"  name="jiarewendushangxian" value="{10}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
         
       <!-- 系统参数设置 -->
        
        <dl class="sbcs">
        	<dt>电导率显示方式2D(1TDS 2电导率)</dt>
				<input type="hidden" id="cs1" class="weui-switch"  name="toubiqileixing"  value="{11}"  >
            <dd class="cssz">
				                <div class="cell-right"><span class="switch-on" id="wifi" onclick="delete_tag1()"></span></div>
				            </dd>
		   </dd>
            <div class="clear"></div>
        </dl>
		
		 <dl class="sbcs">
        	<dt>TDS修正数据3D(0-255)</dt>
            <dd class="cssz"><input type="number"  name="xunhuanchongxishijian" value="{12}" class="water_sales deducting_fee_inp"></dd>
            <div class="clear"></div>
        </dl>
        <dl class="sbcs">
        	<dt>洗膜方式4D(1低压 2高压)</dt>
            <dd class="cssz">
			<input type="hidden" id="cs2" class="weui-switch"  name="yuyinyinliangtiaojie"  value="{13}"  >
			
			                <div class="cell-right"><span class="switch-on" id="wifi" onclick="delete_tag3()"></span></div>
							</dd>
            <div class="clear"></div>
        </dl>
        
            <div class="hfcc">
				<input type="hidden" name="Id" value="066f5e72-3c84-ea11-b0df-87120c3b66e0">
				<button class="btn_recovery" id="recovery" type="button">恢复出厂设置</button>
				<button type="submit" id="h-submit" class="queding" >确定</button>

                <div class="clear"></div>
            </div>
    `
    
    String.format = function(src){  
            if (arguments.length == 0) return null;  
            var args = Array.prototype.slice.call(arguments, 1);  
            return src.replace(/\{(\d+)\}/g, function(m, i){  
                return args[i];  
            });  
        };  


    $(document).ready(function(){
        var id = window.location.href.split("/")[8]
        var url = "/deviceQuery/" + id + "/"
        $.ajax({
                type:'GET',
                url:url,
                cache: false,
                beforeSend: function (XMLHttpRequest) {
                    XMLHttpRequest.setRequestHeader("Authorization","JWT "+$.cookie('token'));
                },
                success:function(data){
                    // console.log(data)
                    tmpStr = String.format(tmpStr,
                        data["device_id"],
                        data["_1t"],
                        data["_2t"],
                        data["_3t"],
                        data["_4t"],
                        data["_5t"],
                        data["_6t"],
                        data["_7t"],
                        data["_8t"],
                        data["_1c"],
                        data["_2c"],
                        data["_2d"],
                        data["_3d"],
                        data["_4d"],
                    )
                    $("#h-form").append(tmpStr)
                        
                }
        })
    })

    function add_submit(){
            var data = $(".warp #h-form").serializeArray();
            Data = {};
            patchData = {};
            $(data).each(function(i){
                Data[this.name] = this.value;
            });
            console.log(Data)
            patchData["_1t"]=Data["yukoufeicanshu"]
            patchData["_2t"]=Data["liuliangjimaichongshu"]
            patchData["_3t"]=Data["shuakadashuishijian"]
            patchData["_4t"]=Data["toubidashuishijian"]
            patchData["_5t"]=Data["maimaichongshuiliang"]
            patchData["_6t"]=Data["qianshuhuishoushijian"]
            patchData["_7t"]=Data["chouyangshajunshijian"]
            patchData["_8t"]=Data["chouyangshajunjiange"]
            patchData["_1c"]=Data["jiarewenduxiaxian"]
            patchData["_2c"]=Data["jiarewendushangxian"]
            patchData["_2d"]=Data["toubiqileixing"]
            patchData["_3d"]=Data["xunhuanchongxishijian"]
            patchData["_4d"]=Data["yuyinyinliangtiaojie"]
            console.log(patchData)

            var id = window.location.href.split("/")[8]
            url = "/deviceEdit/" + id + "/"
            $.ajax({
                type:'PATCH',
                url:url,
                cache: false,
                data: patchData,
                beforeSend: function (XMLHttpRequest) {
                    XMLHttpRequest.setRequestHeader("Authorization","JWT "+$.cookie('token'));
                    XMLHttpRequest.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"));
                },
                success:function(data){
                    console.log(data)
                    dialog.success("参数设置成功")
                }
            });
            return false;
    }
        

</script>
<script type="text/javascript">

function delete_tag1(){
    //阻止冒泡上层click
    event.stopPropagation();
	document.getElementById('cs1').value='2';
}
 
function delete_tag2(){
    //阻止冒泡上层click
    event.stopPropagation();
	document.getElementById('cs1').value='1';
}
function delete_tag3(){
    //阻止冒泡上层click
    event.stopPropagation();
	document.getElementById('cs2').value='2';
}
 
function delete_tag4(){
    //阻止冒泡上层click
    event.stopPropagation();
	document.getElementById('cs2').value='1';
}

$("#recovery").click(function(){
    var Id = "066f5e72-3c84-ea11-b0df-87120c3b66e0";
    url = "/index/setting/recover.html";
    data = {};
    data['Id'] = Id;
    $.post(url,data,function(res){
        if (res.status == '1') {
            dialog.success(res.message,res.url);
        }else if(res.status == '0'){
            dialog.error(res.message,res.url);
        }
    },"JSON");
});

</script>

</body>
</html>